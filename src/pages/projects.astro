---
import BaseHead from '../components/BaseHead.astro';
import Header from '../components/Header.astro';
import Footer from '../components/Footer.astro';
import { SITE_TITLE } from '../consts';
import { Image } from 'astro:assets';
import AuthorLink from '../components/AuthorLink.astro';
import projectsData from '../data/projects.json';

const projects = projectsData.sort((a, b) => b.year - a.year);
---

<!doctype html>
<html lang="en">
	<head>
		<BaseHead title={`Projects | ${SITE_TITLE}`} description="Research Projects" />
		<style>
			.project-meta {
				margin-top: 1rem;
				font-size: 0.9rem;
				color: var(--color-text-muted);
				display: flex;
				align-items: center;
				gap: 0.5rem;
				flex-wrap: wrap;
			}
			.meta-label {
				font-weight: 600;
				color: var(--color-text-main);
				margin-right: 0.25rem;
			}
		</style>
	</head>
	<body>
		<Header />
		<main>
			<h1>Research Projects</h1>
			<p>Ongoing and completed research initiatives led by our lab members.</p>
			
			<div class="grid-2">
				{projects.length > 0 ? projects.map((project) => (
					<div class="project-card">
						{project.heroImage ? (
							<img 
								src={project.heroImage} 
								alt={project.title}
								style="width: 100%; height: 200px; object-fit: cover; display: block;"
							/>
						) : (
							<img 
								src="https://placehold.co/600x400?text=Project" 
								alt="Project Placeholder"
								style="width: 100%; height: 200px; object-fit: cover; display: block;"
							/>
						)}
						<div class="project-content">
							<span class="project-status">{project.status} &bull; {project.year}</span>
							
							<h3 style="margin-top: 0; font-size: 1.25rem; line-height: 1.3;">
								{project.link ? (
									<a href={project.link} target="_blank" style="color: inherit; text-decoration: none;">{project.title}</a>
								) : (
									project.title
								)}
							</h3>
							
							<p style="margin-bottom: 1rem;">{project.description}</p>
							
							{project.authors && project.authors.length > 0 && (
								<div class="project-meta">
									<span class="meta-label">Team:</span>
									{project.authors.map((authorId, i) => (
										<span>
											<AuthorLink nameOrSlug={authorId} />
											{i < project.authors!.length - 1 ? ', ' : ''}
										</span>
									))}
								</div>
							)}

							{project.link && (
								<div style="margin-top: 1.5rem;">
									<a href={project.link} target="_blank" class="btn-outline" style="font-size: 0.85rem;">View Project &rarr;</a>
								</div>
							)}
						</div>
					</div>
				)) : (
                    <p>No projects found in <code>src/data/projects.json</code>.</p>
                )}
			</div>
		</main>
		<Footer />
	</body>
</html>
