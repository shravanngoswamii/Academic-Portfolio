---
import { Image } from 'astro:assets';
import { getCollection } from 'astro:content';
import BaseHead from '../../components/BaseHead.astro';
import Footer from '../../components/Footer.astro';
import FormattedDate from '../../components/FormattedDate.astro';
import Header from '../../components/Header.astro';
import AuthorLink from '../../components/AuthorLink.astro';
import { SITE_DESCRIPTION, SITE_TITLE } from '../../consts';

const posts = (await getCollection('blog')).sort(
	(a, b) => b.data.pubDate.valueOf() - a.data.pubDate.valueOf(),
);
---

<!doctype html>
<html lang="en">
	<head>
		<BaseHead title={SITE_TITLE} description={SITE_DESCRIPTION} />
        <style>
            /* Local overrides for specific blog list styling */
            .blog-list {
                display: flex;
                flex-direction: column;
                gap: 3rem; /* Increased spacing for premium feel */
                margin-top: 3rem;
            }
            .blog-post-card {
                display: flex;
                gap: 2.5rem;
                align-items: flex-start;
                padding-bottom: 3rem;
                border-bottom: 1px solid var(--color-border);
            }
            .blog-post-card:last-child {
                border-bottom: none;
            }
            
            /* Thumbnail Styling - Moved to Right */
            .blog-thumb {
                width: 280px; /* Fixed, reasonable width for desktop */
                flex-shrink: 0;
                border-radius: 8px;
                overflow: hidden;
                box-shadow: var(--shadow-md); /* Slightly deeper shadow */
                aspect-ratio: 16/9;
                display: block;
                order: 2; /* Ensure image is visually second (right side) if DOM order varies, though we swapped HTML too */
                align-self: flex-start;
            }
            .blog-thumb img {
                width: 100%;
                height: 100%;
                object-fit: cover;
                transition: transform 0.4s ease, filter 0.3s ease;
            }
            .blog-post-card:hover .blog-thumb img {
                transform: scale(1.03);
                filter: brightness(1.05);
            }

            /* Content Styling */
            .blog-content {
                flex: 1;
                order: 1; /* Content on the left */
                padding-right: 1rem;
            }
            .blog-title {
                margin: -0.2rem 0 0.75rem 0;
                font-family: var(--font-serif);
                font-size: 1.75rem;
                line-height: 1.25;
                letter-spacing: -0.01em;
            }
            .blog-title a {
                color: var(--color-text-main);
                text-decoration: none;
                transition: color 0.2s;
            }
            .blog-title a:hover {
                color: var(--color-accent);
            }
            .blog-meta {
                font-size: 0.85rem;
                color: var(--color-text-muted);
                margin-bottom: 1rem;
                display: flex;
                flex-wrap: wrap;
                gap: 0.5rem;
                align-items: center;
                text-transform: uppercase;
                letter-spacing: 0.05em;
                font-weight: 500;
            }
            .meta-divider {
                color: #ddd;
            }
            .blog-desc {
                margin: 0 0 1.5rem 0;
                color: var(--color-text-muted);
                line-height: 1.7;
                font-size: 1.05rem;
            }
            .read-more {
                font-size: 0.9rem;
                font-weight: 700;
                color: var(--color-accent);
                display: inline-flex;
                align-items: center;
                text-decoration: none;
                border-bottom: 2px solid transparent;
                transition: border-color 0.2s;
            }
            .read-more:hover {
                border-bottom-color: var(--color-accent);
            }
            
            @media (max-width: 720px) {
                .blog-post-card {
                    flex-direction: column-reverse; /* Image on top for mobile */
                    gap: 1.5rem;
                    padding-bottom: 2rem;
                }
                .blog-thumb {
                    width: 100%; /* Full width on mobile */
                    height: auto;
                    aspect-ratio: 16/9;
                    box-shadow: var(--shadow-sm);
                }
                .blog-content {
                    padding-right: 0;
                }
                .blog-title {
                    font-size: 1.5rem;
                }
            }
        </style>
	</head>
	<body>
		<Header />
		<main>
			<h1>Lab News & Updates</h1>
            <p style="margin-bottom: 2rem; max-width: 700px; color: var(--color-text-muted);">
                Explore our latest research highlights, tutorials, and announcements.
            </p>

            <div class="blog-list">
                {
                    posts.map((post) => (
                        <article class="blog-post-card">
                            <div class="blog-content">
                                <h2 class="blog-title">
                                    <a href={`/blog/${post.id}/`}>{post.data.title}</a>
                                </h2>
                                
                                <div class="blog-meta">
                                    <FormattedDate date={post.data.pubDate} />
                                    
                                    {post.data.authors && post.data.authors.length > 0 && (
                                        <>
                                            <span class="meta-divider">&bull;</span>
                                            {post.data.authors.map((authorId, i) => (
                                                <span>
                                                    <AuthorLink nameOrSlug={authorId} />
                                                    {i < post.data.authors!.length - 1 ? ', ' : ''}
                                                </span>
                                            ))}
                                        </>
                                    )}
                                </div>

                                <p class="blog-desc">
                                    {post.data.description}
                                </p>
                                
                                <a href={`/blog/${post.id}/`} class="read-more">Read Article &rarr;</a>
                            </div>

                            <a href={`/blog/${post.id}/`} class="blog-thumb">
                                {post.data.heroImage ? (
                                    <Image width={560} height={315} src={post.data.heroImage} alt="" />
                                ) : (
                                    <img src="https://placehold.co/560x315/f3f4f6/1f2937?text=Article" alt="No image" />
                                )}
                            </a>
                        </article>
                    ))
                }
                
                {posts.length === 0 && (
                    <p style="text-align: center; color: var(--color-text-muted);">
                        No blog posts found.
                    </p>
                )}
            </div>
		</main>
		<Footer />
	</body>
</html>
